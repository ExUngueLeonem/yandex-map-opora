//import {oporaMembersData}  from "./oporaMembersData.js";
//oporaMembersData = require("./oporaMembersData.js");

const oporaMembersData = {
    "members": [
        {
            "name": "Дугин Виталий Николаевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./novocherkassk",
            "direction": "Новочеркасск"
        },
        {
            "name": "Оплачков Артем Сергеевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./millerovskiy-rayon",
            "direction": "Миллеровский район"
        },
        {
            "name": "Продченко Сергей Юрьевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./salskiy-rayon",
            "direction": "Сальский район"
        },
        {
            "name": "Филиппенко Андрей Юрьевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./novoshahtinsk",
            "direction": "Новошахтинск"
        },
        {
            "name": "Халын Алексей Викторович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./rostov-na-donu", 
            "direction": "Ростов-на-Дону"
        },
        {
            "name": "Никитченко Олег Николаевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./bataysk",
            "direction": "Батайск"
        },
        {
            "name": "Сечкин Дмитрий Петрович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./voroshilovskiy-rayon-rostov-na-donu",
            "direction": "Ворошиловский район (Ростов-на-Дону)"
        },
        {
            "name": "Сечкин Дмитрий Петрович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./leninskiy-rayon-rostov-na-donu",
            "direction": "Ленинский район (Ростов-на-Дону)"
        },
        {
            "name": "Чемеркина Инна Анатольевна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./oktyabrskiy-rayon-rostov-na-donu",
            "direction": "Октябрьский район (Ростов-на-Дону)"
        },
        {
            "name": "Казанцев Дмитрий Александрович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./bagaevskiy-rayon",
            "direction": "Багаевский район"
        },
        {
            "name": "Кобелева Галина Александровна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./ust-donetskiy-rayon",
            "direction": "Усть-Донецкий район"
        },
        {
            "name": "Джереджа Антон Николаевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./matveevo-kurganskiy-rayon",
            "direction": "Матвеево-Курганский район"
        },
        {
            "name": "Хохлачев Евгений Сергеевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./oktyabrskiy-rayon-rostovskaya-oblast",
            "direction": "Октябрьский район (Ростовская область)"
        },
        {
            "name": "Бурцев Анатолий Юрьевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./belokalitvinskiy-rayon",
            "direction": "Белокалитвинский район"
        },
        {
            "name": "Лоскутов Роман Владимирович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./chertkovskiy-rayon",
            "direction": "Чертковский район"
        },
        {
            "name": "Каменская Ксения Сергеевна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./egorlykskiy-rayon",
            "direction": "Егорлыкский район"
        },
        {
            "name": "Ольховский Сергей Валерьевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./volgodonsk",
            "direction": "Волгодонск"
        },
        {
            "name": "Мелехов Михаил Георгиевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./myasnikovskiy-rayon",
            "direction": "Мясниковский район"
        },
        {
            "name": "Нестеренко Максим Александрович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./gukovo-gorod",
            "direction": "Гуково (город)"
        },
        {
            "name": "Дорофеев Дмитрий Валерьевич",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./krasnosulinskiy-rayon",
            "direction": "Красносулинский район"
        },
        {
            "name": "Березовский Алексей Владимирович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./sovetskiy-rayon-rostov-na-donu",
            "direction": "Советский район (Ростов-на-Дону)"
        },
        {
            "name": "Каралов Назим Вахидович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./zverevo",
            "direction": "Зверево"
        },
        {
            "name": "Швец Сергей Иванович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./sholohovskiy-rayon",
            "direction": "Шолоховский район"
        },
        {
            "name": "Сафронова Ирина Сергеевна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./shahty",
            "direction": "Шахты"
        },
        {
            "name": "Щербина Евгений Владимирович",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./taganrog",
            "direction": "Таганрог"
        },
        {
            "name": "Игнатенко Елена Александровна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./zernogradskiy-rayon",
            "direction": "Зерноградский район"
        },
        {
            "name": "asdasdf",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "asdasdf",
            "direction": "Ростовская область"
        },
        {
            "name": "Полякова Алина Сергеевна",
            "photoSrc": "\\netcat_files\\userfiles\\user-0_2.jpg",
            "linkHref": "./kirovskiy-rayon-rostov-na-donu",
            "direction": "Кировский район (Ростов-на-Дону)"
        }
    ]
}


/* ================================================================= */

const fs = require("fs");

function generateColor() {
    return '#' + Math.floor(Math.random() * 16777215).toString(16)
}

function generateOutputJson(path = "./input.geojson") {
    console.log("Синхронное чтение файла")
    let fileContent = fs.readFileSync(path);
    objFileContent = JSON.parse(fileContent);   // objFileContent.features - массив с содержимым

    let result = objFileContent.features.filter(features => {
        if (features.geometry.type === 'MultiPolygon') {
            if (!features.properties.name) return false

            features.geometry.type = 'Polygon';

            for (elem of oporaMembersData.members) {
                if (elem.direction === features.properties.wikipedia.slice(3)) {
                    features.properties.name = `
                    <a href="${elem.linkHref}" class="ya-baloon">
                        <img src="${elem.photoSrc}" class="ya-baloon__img">
                        <div class="ya-baloon__description">
                            <div class="ya-baloon__region">
                            ${elem.direction}
                            </div >
                            <div class="ya-baloon__director">
                                Председатель: 
                                <br>
                                <strong>
                                    ${elem.name}
                                </strong>
                            </div>
                        </div>
                    </a>`                    
                
                    //${elem.linkHref}
                    //${elem.photoSrc}
                    //${elem.direction}
                    //${elem.name}

                }
            }

            //features.properties.name = '<a href="./rostov-na-donu" class="ya-baloon"> <img src="/netcat_files/userfiles/info/manager/gershman.jpg" class="ya-baloon__img"><div class="ya-baloon__description"> Ростов-на-Дону. Председатель - Халын Алексей Викторович </div></a>'

            features.geometry.coordinates = features.geometry.coordinates[0];       //раскрывает лишние скобки в coordinates
            features.properties = {
                ...features.properties,
                "fill": generateColor(),
                "fill-opacity": 0.3,
                "stroke": generateColor(),
                "stroke-width": "2",
                "stroke-opacity": 0.9
            }

            //делает ростовскую область красной и удаляет название
            if (features.properties.wikipedia.slice(3) === "Ростовская область") {
                //features.geometry.type = "LineString"; features.geometry.coordinates = features.geometry.coordinates[0];    //меняет полигон на LineString
                features.properties.name = '';
                features.properties.fill = '#b90710';
            }

            return true
        }
        return false
    })

    let resObj = {
        "type": "FeatureCollection",
        "generator": "JOSM",
    }

    //перемещает указанную область на верх массива
    function elemBubbling(elemName, arr) {
        let result = arr
        result.sort((a, b) => {
            if (a.properties.wikipedia.slice(3) === elemName) return -1
            return 0
        })
        return result
    }
    result = elemBubbling('Ростовская область', result);
    
    resObj.features = result;
    return JSONfileContent = JSON.stringify(resObj);
}

fs.writeFileSync("output.geojson", generateOutputJson()) //записываем в файл


